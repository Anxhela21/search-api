{"version":3,"sources":["../../../src/v2/connectors/kube.js"],"names":["KubeConnector","constructor","token","kubeApiEndpoint","config","get","httpLib","request","http","path","opts","options","_","merge","url","method","headers","Authorization","then","res","body","post","jsonBody","defaults","json","patch"],"mappings":";;;;;;AASA;;;;AACA;;;;AACA;;;;;;AAEe,MAAMA,aAAN,CAAoB;AACjCC,cAAY;AACVC,YAAQ,UADE;AAEVC,sBAAmB,GAAEC,iBAAOC,GAAP,CAAW,gBAAX,CAA6B,EAAhC,IAAqC,gCAF7C;AAGVC,cAAUC;AAHA,MAIR,EAJJ,EAIQ;AACN,SAAKJ,eAAL,GAAuBA,eAAvB;AACA,SAAKD,KAAL,GAAaA,KAAb;AACA,SAAKM,IAAL,GAAYF,OAAZ;AACD;;AAED;;;;;;;AAOAD,MAAII,OAAO,EAAX,EAAeC,OAAO,EAAtB,EAA0B;AACxB,UAAMC,UAAUC,iBAAEC,KAAF,CAAQ;AACtBC,WAAM,GAAE,KAAKX,eAAgB,GAAEM,IAAK,EADd;AAEtBM,cAAQ,KAFc;AAGtBC,eAAS;AACPC,uBAAgB,UAAS,KAAKf,KAAM;AAD7B;AAHa,KAAR,EAMbQ,IANa,CAAhB;;AAQA,WAAO,KAAKF,IAAL,CAAUI,iBAAEC,KAAF,CAAQF,OAAR,EAAiBD,IAAjB,CAAV,EAAkCQ,IAAlC,CAAuCC,OAAOA,IAAIC,IAAlD,CAAP;AACD;;AAEDC,OAAKZ,OAAO,EAAZ,EAAgBa,QAAhB,EAA0BZ,OAAO,EAAjC,EAAqC;AACnC,UAAMa,WAAW;AACfT,WAAM,GAAE,KAAKX,eAAgB,GAAEM,IAAK,EADrB;AAEfM,cAAQ,MAFO;AAGfC,eAAS;AACPC,uBAAgB,UAAS,KAAKf,KAAM;AAD7B,OAHM;AAMfsB,YAAMF;AANS,KAAjB;;AASA,WAAO,KAAKd,IAAL,CAAUI,iBAAEC,KAAF,CAAQU,QAAR,EAAkBb,IAAlB,CAAV,EAAmCQ,IAAnC,CAAwCC,OAAOA,IAAIC,IAAnD,CAAP;AACD;;AAEDK,QAAMhB,OAAO,EAAb,EAAiBa,QAAjB,EAA2BZ,OAAO,EAAlC,EAAsC;AACpC,UAAMa,WAAW;AACfT,WAAM,GAAE,KAAKX,eAAgB,GAAEM,IAAK,EADrB;AAEfM,cAAQ,OAFO;AAGfC,eAAS;AACPC,uBAAgB,UAAS,KAAKf,KAAM,EAD7B;AAEP,wBAAgB;AAFT,OAHM;AAOfsB,YAAMF;AAPS,KAAjB;;AAUA,WAAO,KAAKd,IAAL,CAAUI,iBAAEC,KAAF,CAAQU,QAAR,EAAkBb,IAAlB,CAAV,EAAmCQ,IAAnC,CAAwCC,OAAOA,IAAIC,IAAnD,CAAP;AACD;AAvDgC;kBAAdpB,a,EAbrB","file":"kube.js","sourcesContent":["/** *****************************************************************************\n * Licensed Materials - Property of IBM\n * (c) Copyright IBM Corporation 2018, 2019. All Rights Reserved.\n *\n * Note to U.S. Government Users Restricted Rights:\n * Use, duplication or disclosure restricted by GSA ADP Schedule\n * Contract with IBM Corp.\n ****************************************************************************** */\n\nimport _ from 'lodash';\nimport request from '../lib/request';\nimport config from '../../../config';\n\nexport default class KubeConnector {\n  constructor({\n    token = 'localdev',\n    kubeApiEndpoint = `${config.get('API_SERVER_URL')}` || 'https://kubernetes.default.svc',\n    httpLib = request,\n  } = {}) {\n    this.kubeApiEndpoint = kubeApiEndpoint;\n    this.token = token;\n    this.http = httpLib;\n  }\n\n  /**\n   * Excecute Kube API GET requests.\n   *\n   * @param {*} path - API path\n   * @param {*} opts - HTTP request options\n   * @param {*} noCache - Don't use a previously cached request.\n   */\n  get(path = '', opts = {}) {\n    const options = _.merge({\n      url: `${this.kubeApiEndpoint}${path}`,\n      method: 'GET',\n      headers: {\n        Authorization: `Bearer ${this.token}`,\n      },\n    }, opts);\n\n    return this.http(_.merge(options, opts)).then(res => res.body);\n  }\n\n  post(path = '', jsonBody, opts = {}) {\n    const defaults = {\n      url: `${this.kubeApiEndpoint}${path}`,\n      method: 'POST',\n      headers: {\n        Authorization: `Bearer ${this.token}`,\n      },\n      json: jsonBody,\n    };\n\n    return this.http(_.merge(defaults, opts)).then(res => res.body);\n  }\n\n  patch(path = '', jsonBody, opts = {}) {\n    const defaults = {\n      url: `${this.kubeApiEndpoint}${path}`,\n      method: 'PATCH',\n      headers: {\n        Authorization: `Bearer ${this.token}`,\n        'Content-Type': 'application/json-patch+json',\n      },\n      json: jsonBody,\n    };\n\n    return this.http(_.merge(defaults, opts)).then(res => res.body);\n  }\n}\n"]}